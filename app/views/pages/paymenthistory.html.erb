<!-- Predefined Calculations -->
<% from_date = @lease.start_date.month %>
<% to_date = @lease.end_date.strftime("%B, %Y") %>
<% monthly = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12] %>
<% everytwomonthly = [1, 3, 5, 7, 9, 11, ] %>
<% everythreemonths = [1, 4, 7, 10, 12] %>
<% quarterly = [1, 4, 7, 10] %>
<% everysixmonths = [1,6] %>
<% everyyear = [1] %>

<%# ((@lease.start_date)...(@lease.end_date)).to_a.map{|x| x.to_s(:db)} %>
<%# start_month = @lease.start_date.strftime("%m/%Y").to_date %>
<%# end_month = @lease.end_date.strftime("%m/%Y").to_date %>

<h4><%= @lease.start_date %></h4>
<h4><%= @lease.end_date %></h4>

<% nonsense = (@lease.start_date...@lease.end_date).map {|m| m.month } %>
  <% months = nonsense.uniq { |m| m} %>
  <% if @lease.duration/12 >= 1 %>
    <% @final_months =  months * (@lease.duration / 12) %>
  <% else %>
  <% @final_months = months %>
  <% end %>

  <%= @final_months %>

<% if @lease.installments == 12 %>

  <div class="container">
    <div class="row">
      <div class="col-md-6 payment-table">
        <table class="table table-responsive table-hover">
          <thead class="title">
            <tr>
              <td class="text-center" colspan="1"><i class="fa fa-bars menu-open"></i></td>
              <td class="text-center" colspan="3">Payment</td>
            </tr>
          </thead>
          <tbody class="payment-table-content">
            <%# (@lease.duration * 12).times do  %>
            <% @final_months.drop(from_date -1).each do |m| %>
                <tr class="true">
                    <td><%= cl_image_tag @user.photo, class: 'avatar-payment-not-paid-card' %></td>
                  <td><%= @user.first_name[0] %>. <%= @user.last_name %></td>
                  <td><%= Date::MONTHNAMES[m] %>, <%= Date.today.year %></td>
                  <td>$<span><%= @lease.rent %></span></td>
                  <td>
                    <%= link_to user_lease_performainvoice_path(@user, @lease) do  %>
                      <button class="primary-button"><i class="fas fa-file-invoice"></i></button>
                    <% end %>
                  </td>
                </tr>
            <% end %>
            <% monthly[0..from_date - 2].each do |m| %>
              <tr class="true">
                  <td><%= cl_image_tag @user.photo, class: 'avatar-payment-not-paid-card' %></td>
                  <td><%= @user.first_name[0] %>. <%= @user.last_name %></td>
                  <td><%= Date::MONTHNAMES[m] %>,  <%= Date.today.next_year.year %></td>
                  <td>$<span><%= @lease.rent %></span></td>
                  <td>
                    <%= link_to user_lease_performainvoice_path(@user, @lease) do  %>
                      <button class="primary-button"><i class="fas fa-file-invoice"></i></button>
                    <% end %>
                  </td>
                </tr>
            <% end %>
                <td colspan="2"></td>
                <td>Deposit</td>
                <td>$<%= @lease.deposit %></td>
               </tr>
                <td colspan="2"></td>
                <td>Total</td>
                <td><b><u>$<%= @lease.rent * (@lease.duration * 12) %></b></u></td>
              </tr>
            </tfooter>
          </tbody>
        </table>
      </div>
      <!-- <div class="col-md-6">
        <table class="table table-responsive table-hover">
          <thead class="title">
            <tr>
              <td class="text-center" colspan="1"><i class="fa fa-bars menu-open"></i></td>
              <td class="text-center" colspan="3">Traces</td>
            </tr>
          </thead>
          <tbody class="payment-table-content">
            <tr>
              <td class="text-center" colspan="4">No Traces provided</td>
            </tr>
          </tbody>
        </table>
      </div> -->

    </div>
  </div>

<% elsif @lease.installments == 6 %>

  <div class="container">
    <div class="row">
      <div class="col-md-6 payment-table">
        <table class="table table-responsive table-hover">
          <thead class="title">
            <tr>
              <td class="text-center" colspan="1"><i class="fa fa-bars menu-open"></i></td>
              <td class="text-center" colspan="3">Payment</td>
            </tr>
          </thead>
          <tbody class="payment-table-content">
            <%# (@lease.duration * 12).times do  %>
            <% everytwomonthly.drop(from_date - 1).each do |m| %>
                <tr class="true">
                    <td><%= cl_image_tag @user.photo, class: 'avatar-payment-not-paid-card' %></td>
                  <td><%= @user.first_name[0] %>. <%= @user.last_name %></td>
                  <td><%= Date::MONTHNAMES[m] %>, <%= Date.today.year %></td>
                  <td>$<span><%= @lease.rent %></span></td>
                  <td>
                    <%= link_to user_lease_performainvoice_path(@user, @lease) do  %>
                      <button class="primary-button"><i class="fas fa-file-invoice"></i></button>
                    <% end %>
                  </td>
                </tr>
            <% end %>
            <% everytwomonthly[0..from_date - 2].each do |m| %>
              <tr class="true">
                  <td><%= cl_image_tag @user.photo, class: 'avatar-payment-not-paid-card' %></td>
                  <td><%= @user.first_name[0] %>. <%= @user.last_name %></td>
                  <td><%= Date::MONTHNAMES[m] %>,  <%= Date.today.next_year.year %></td>
                  <td>$<span><%= @lease.rent %></span></td>
                  <td>
                    <%= link_to user_lease_performainvoice_path(@user, @lease) do  %>
                      <button class="primary-button"><i class="fas fa-file-invoice"></i></button>
                    <% end %>
                  </td>
                </tr>
            <% end %>
                <td colspan="2"></td>
                <td>Deposit</td>
                <td>$<%= @lease.deposit %></td>
               </tr>
                <td colspan="2"></td>
                <td>Total</td>
                <td><b><u>$<%= @lease.rent * (@lease.duration * 12) %></b></u></td>
              </tr>
            </tfooter>
          </tbody>
        </table>
      </div>
      <!-- <div class="col-md-6">
        <table class="table table-responsive table-hover">
          <thead class="title">
            <tr>
              <td class="text-center" colspan="1"><i class="fa fa-bars menu-open"></i></td>
              <td class="text-center" colspan="3">Traces</td>
            </tr>
          </thead>
          <tbody class="payment-table-content">
            <tr>
              <td class="text-center" colspan="4">No Traces provided</td>
            </tr>
          </tbody>
        </table>
      </div> -->

    </div>
  </div>


<% elsif @lease.installments == 4 %>

  <div class="container">
    <div class="row">
      <div class="col-md-6 payment-table">
        <table class="table table-responsive table-hover">
          <thead class="title">
            <tr>
              <td class="text-center" colspan="1"><i class="fa fa-bars menu-open"></i></td>
              <td class="text-center" colspan="3">Payment</td>
            </tr>
          </thead>
          <tbody class="payment-table-content">
            <%# (@lease.duration * 12).times do  %>
            <% quarterly.drop(from_date - 1).each do |m| %>
                <tr class="true">

                    <td><%= cl_image_tag @user.photo, class: 'avatar-payment-not-paid-card' %></td>

                  <td><%= @user.first_name[0] %>. <%= @user.last_name %></td>
                  <td><%= Date::MONTHNAMES[m] %>, <%= Date.today.year %></td>
                  <td>$<span><%= @lease.rent %></span></td>
                  <td>
                    <%= link_to user_lease_performainvoice_path(@user, @lease) do  %>
                      <button class="primary-button"><i class="fas fa-file-invoice"></i></button>
                    <% end %>
                  </td>
                </tr>
            <% end %>
            <% quarterly[0..from_date - 2].each do |m| %>
              <tr class="true">
                  <td><%= cl_image_tag @user.photo, class: 'avatar-payment-not-paid-card' %></td>
                  <td><%= @user.first_name[0] %>. <%= @user.last_name %></td>
                  <td><%= Date::MONTHNAMES[m] %>,  <%= Date.today.next_year.year %></td>
                  <td>$<span><%= @lease.rent %></span></td>
                  <td>
                    <%= link_to user_lease_performainvoice_path(@user, @lease) do  %>
                      <button class="primary-button"><i class="fas fa-file-invoice"></i></button>
                    <% end %>
                  </td>
                </tr>
            <% end %>
                <td colspan="2"></td>
                <td>Deposit</td>
                <td>$<%= @lease.deposit %></td>
               </tr>
                <td colspan="2"></td>
                <td>Total</td>
                <td><b><u>$<%= @lease.rent * (@lease.duration * 12) %></b></u></td>
              </tr>
            </tfooter>
          </tbody>
        </table>
      </div>
      <!-- <div class="col-md-6">
        <table class="table table-responsive table-hover">
          <thead class="title">
            <tr>
              <td class="text-center" colspan="1"><i class="fa fa-bars menu-open"></i></td>
              <td class="text-center" colspan="3">Traces</td>
            </tr>
          </thead>
          <tbody class="payment-table-content">
            <tr>
              <td class="text-center" colspan="4">No Traces provided</td>
            </tr>
          </tbody>
        </table>
      </div> -->

    </div>
  </div>

<% elsif @lease.installments == 3 %>

  <div class="container">
    <div class="row">
      <div class="col-md-6 payment-table">
        <table class="table table-responsive table-hover">
          <thead class="title">
            <tr>
              <td class="text-center" colspan="1"><i class="fa fa-bars menu-open"></i></td>
              <td class="text-center" colspan="3">Payment</td>
            </tr>
          </thead>
          <tbody class="payment-table-content">
            <%# (@lease.duration * 12).times do  %>
            <% everythreemonths.drop(from_date - 1).each do |m| %>
                <tr class="true">

                    <td><%= cl_image_tag @user.photo, class: 'avatar-payment-not-paid-card' %></td>

                  <td><%= @user.first_name[0] %>. <%= @user.last_name %></td>
                  <td><%= Date::MONTHNAMES[m] %>, <%= Date.today.year %></td>
                  <td>$<span><%= @lease.rent %></span></td>
                  <td>
                    <%= link_to user_lease_performainvoice_path(@user, @lease) do  %>
                      <button class="primary-button"><i class="fas fa-file-invoice"></i></button>
                    <% end %>
                  </td>
                </tr>
            <% end %>
            <% everythreemonths[0..from_date - 2].each do |m| %>
              <tr class="true">
                  <td><%= cl_image_tag @user.photo, class: 'avatar-payment-not-paid-card' %></td>
                  <td><%= @user.first_name[0] %>. <%= @user.last_name %></td>
                  <td><%= Date::MONTHNAMES[m] %>,  <%= Date.today.next_year.year %></td>
                  <td>$<span><%= @lease.rent %></span></td>
                  <td>
                    <%= link_to user_lease_performainvoice_path(@user, @lease) do  %>
                      <button class="primary-button"><i class="fas fa-file-invoice"></i></button>
                    <% end %>
                  </td>
                </tr>
            <% end %>
                <td colspan="2"></td>
                <td>Deposit</td>
                <td>$<%= @lease.deposit %></td>
               </tr>
                <td colspan="2"></td>
                <td>Total</td>
                <td><b><u>$<%= @lease.rent * (@lease.duration * 12) %></b></u></td>
              </tr>
            </tfooter>
          </tbody>
        </table>
      </div>
      <!-- <div class="col-md-6">
        <table class="table table-responsive table-hover">
          <thead class="title">
            <tr>
              <td class="text-center" colspan="1"><i class="fa fa-bars menu-open"></i></td>
              <td class="text-center" colspan="3">Traces</td>
            </tr>
          </thead>
          <tbody class="payment-table-content">
            <tr>
              <td class="text-center" colspan="4">No Traces provided</td>
            </tr>
          </tbody>
        </table>
      </div> -->

    </div>
  </div>

<% elsif @lease.installments == 2 %>

  <div class="container">
    <div class="row">
      <div class="col-md-6 payment-table">
        <table class="table table-responsive table-hover">
          <thead class="title">
            <tr>
              <td class="text-center" colspan="1"><i class="fa fa-bars menu-open"></i></td>
              <td class="text-center" colspan="3">Payment</td>
            </tr>
          </thead>
          <tbody class="payment-table-content">
            <%# (@lease.duration * 12).times do  %>
            <% everysixmonths.drop(from_date - 1).each do |m| %>
                <tr class="true">

                    <td><%= cl_image_tag @user.photo, class: 'avatar-payment-not-paid-card' %></td>

                  <td><%= @user.first_name[0] %>. <%= @user.last_name %></td>
                  <td><%= Date::MONTHNAMES[m] %>, <%= Date.today.year %></td>
                  <td>$<span><%= @lease.rent %></span></td>
                  <td>
                    <%= link_to user_lease_performainvoice_path(@user, @lease) do  %>
                      <button class="primary-button"><i class="fas fa-file-invoice"></i></button>
                    <% end %>
                  </td>
                </tr>
            <% end %>
            <% everysixmonths[0..from_date - 2].each do |m| %>
              <tr class="true">
                  <td><%= cl_image_tag @user.photo, class: 'avatar-payment-not-paid-card' %></td>
                  <td><%= @user.first_name[0] %>. <%= @user.last_name %></td>
                  <td><%= Date::MONTHNAMES[m] %>,  <%= Date.today.next_year.year %></td>
                  <td>$<span><%= @lease.rent %></span></td>
                  <td>
                    <%= link_to user_lease_performainvoice_path(@user, @lease) do  %>
                      <button class="primary-button"><i class="fas fa-file-invoice"></i></button>
                    <% end %>
                  </td>
                </tr>
            <% end %>
                <td colspan="2"></td>
                <td>Deposit</td>
                <td>$<%= @lease.deposit %></td>
               </tr>
                <td colspan="2"></td>
                <td>Total</td>
                <td><b><u>$<%= @lease.rent * (@lease.duration * 12) %></b></u></td>
              </tr>
            </tfooter>
          </tbody>
        </table>
      </div>
      <!-- <div class="col-md-6">
        <table class="table table-responsive table-hover">
          <thead class="title">
            <tr>
              <td class="text-center" colspan="1"><i class="fa fa-bars menu-open"></i></td>
              <td class="text-center" colspan="3">Traces</td>
            </tr>
          </thead>
          <tbody class="payment-table-content">
            <tr>
              <td class="text-center" colspan="4">No Traces provided</td>
            </tr>
          </tbody>
        </table>
      </div> -->

    </div>
  </div>

<% elsif @lease.installments == 1 %>

  <div class="container">
    <div class="row">
      <div class="col-md-6 payment-table">
        <table class="table table-responsive table-hover">
          <thead class="title">
            <tr>
              <td class="text-center" colspan="1"><i class="fa fa-bars menu-open"></i></td>
              <td class="text-center" colspan="3">Payment</td>
            </tr>
          </thead>
          <tbody class="payment-table-content">
            <%# (@lease.duration * 12).times do  %>
            <% everyyear.drop(from_date - 1).each do |m| %>
                <tr class="true">

                    <td><%= cl_image_tag @user.photo, class: 'avatar-payment-not-paid-card' %></td>

                  <td><%= @user.first_name[0] %>. <%= @user.last_name %></td>
                  <td><%= Date::MONTHNAMES[m] %>, <%= Date.today.year %></td>
                  <td>$<span><%= @lease.rent %></span></td>
                  <td>
                    <%= link_to user_lease_performainvoice_path(@user, @lease) do  %>
                      <button class="primary-button"><i class="fas fa-file-invoice"></i></button>
                    <% end %>
                  </td>
                </tr>
            <% end %>
            <% everyyear[0..from_date - 2].each do |m| %>
              <tr class="true">
                  <td><%= cl_image_tag @user.photo, class: 'avatar-payment-not-paid-card' %></td>
                  <td><%= @user.first_name[0] %>. <%= @user.last_name %></td>
                  <td><%= Date::MONTHNAMES[m] %>,  <%= Date.today.next_year.year %></td>
                  <td>$<span><%= @lease.rent %></span></td>
                  <td>
                    <%= link_to user_lease_performainvoice_path(@user, @lease) do  %>
                      <button class="primary-button"><i class="fas fa-file-invoice"></i></button>
                    <% end %>
                  </td>
                </tr>
            <% end %>
                <td colspan="2"></td>
                <td>Deposit</td>
                <td>$<%= @lease.deposit %></td>
               </tr>
                <td colspan="2"></td>
                <td>Total</td>
                <td><b><u>$<%= @lease.rent * (@lease.duration * 12) %></b></u></td>
              </tr>
            </tfooter>
          </tbody>
        </table>
      </div>
      <!-- <div class="col-md-6">
        <table class="table table-responsive table-hover">
          <thead class="title">
            <tr>
              <td class="text-center" colspan="1"><i class="fa fa-bars menu-open"></i></td>
              <td class="text-center" colspan="3">Traces</td>
            </tr>
          </thead>
          <tbody class="payment-table-content">
            <tr>
              <td class="text-center" colspan="4">No Traces provided</td>
            </tr>
          </tbody>
        </table>
      </div> -->

    </div>
  </div>

<% end %>

<%# raise %>
